{% extends "base2.html.twig" %}

{% block header %}
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">Utilisateurs</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item">
                        <a href="{{ path('app_dashboard') }}">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item active">Utilisateurs</li>
                </ol>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block body %}
<div class="container-fluid">
    <form id="search-form">
        <div class="row">
            <div class="col-md-10 offset-md-1">
                <div class="form-group">
                    <div class="input-group input-group-lg">
                        <input type="search" id="search" class="form-control form-control-lg" placeholder="Trouver un utilisateur" value="">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-lg btn-default">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="container-fluid" style="padding-bottom: 10px">
    <button onclick="openModal()" style="background-color: green; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">Add admin</button>
</div>

<div class="container-fluid">
    <section class="content">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Liste des utilisateurs</h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                        <i class="fas fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="card-body p-0" id="user-list">
                {% include 'dashboard/user/_user_list.html.twig' %}
            </div>
        </div>
    </section>
</div>

<!-- Modal container -->
<div id="myModal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <!-- Modal body to display the form -->
            <div class="modal-body">
                {{ form_start(form) }}
                <div class="form-group">
                    {{ form_label(form.email) }}
                    {{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.email) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.nom) }}
                    {{ form_widget(form.nom, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.nom) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.prenom) }}
                    {{ form_widget(form.prenom, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.prenom) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.n_telephone) }}
                    {{ form_widget(form.n_telephone, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.n_telephone) }}
                </div>
                <div class="form-group">
                    {{ form_label(form.photo) }}
                    {{ form_widget(form.photo, {'attr': {'class': 'form-control-file'}}) }}
                    {{ form_errors(form.photo) }}
                </div>
                        <div class="form-group">
                    {{ form_label(form.password) }}
                    {{ form_widget(form.password , {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.password) }}
                </div>
                {{ form_end(form) }}
            </div>
            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">Save changes</button>
            </div>
        </div>
    </div>
</div>

<script>
function openModal() {
    // Get the modal element
    var modal = document.getElementById("myModal");
    // Open the modal
    modal.style.display = "block";
}

function closeModal() {
    var modal = document.getElementById("myModal");
    modal.style.display = "none";
}

function submitForm() {
    var form = document.querySelector("#myModal form");
    form.submit();
}

document.addEventListener('DOMContentLoaded', function () {
    const searchInput = document.getElementById('search');

    searchInput.addEventListener('keyup', function () {
        const query = searchInput.value;
        fetch(`?search=${query}`, {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById('user-list').innerHTML = html;
        });
    });
});

window.onclick = function(event) {
    var modal = document.getElementById("myModal");
    if (event.target == modal) {
        closeModal();
    }
}
</script>
{% endblock %}
